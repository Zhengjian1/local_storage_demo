!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).IndexedDB=t()}(this,function(){"use strict";var e="object"==typeof process&&process.env&&process.env.NODE_ENV?process.env.NODE_ENV:"production";var t=function(){function t(e,t,n){this.db=e;var o=!0===n?"readwrite":"readonly",r=this.db.transaction(t,o);return this.store=r.objectStore(t),this}return t.prototype.add=function(t){for(var n=t instanceof Array?t:[t],o=0,r=n.length-1;o<=r;o++)this.store.add(n[o]),o===r&&"development"===e&&console.log("数据添加成功");return this},t.prototype.put=function(t){for(var n=t instanceof Array?t:[t],o=0,r=n.length-1;o<=r;o++)this.store.put(n[o]),o===r&&"development"===e&&console.log("数据更新成功");return this},t.prototype.delete=function(t){for(var n=t instanceof Array?t:[t],o=0,r=n.length-1;o<=r;o++)this.store.delete(n[o]),o===r&&"development"===e&&console.log("数据删除成功");return this},t.prototype.clear=function(){return this.store.clear(),"development"===e&&console.log("数据清除成功"),this},t.prototype.get=function(e,t){var n=this;return this.store.get(e).addEventListener("success",function(e){t&&t.call(n,e)},!1),this},t.prototype.cursor=function(e){var t=this,n="function"==typeof arguments[1]?arguments[1]:arguments[2],o=arguments[2]?function(e){if("number"==typeof e)return e;if("string"==typeof e){if(/^\s*>\s*(-?\d+(\.\d+)?)\s*$/i.test(e))return(t=e.match(/(-?\d+(\.\d+)?)/g))?IDBKeyRange.lowerBound(Number(t[0]),!0):void 0;if(/^\s*>\s*=\s*(-?\d+(\.\d+)?)\s*$/i.test(e))return(t=e.match(/(-?\d+(\.\d+)?)/g))?IDBKeyRange.lowerBound(Number(t[0])):void 0;if(/^\s*<\s*(-?\d+(\.\d+)?)\s*$/i.test(e))return(t=e.match(/(-?\d+(\.\d+)?)/g))?IDBKeyRange.upperBound(Number(t[0]),!0):void 0;if(/^\s*<\s*=\s*(-?\d+(\.\d+)?)\s*$/i.test(e))return(t=e.match(/(-?\d+(\.\d+)?)/g))?IDBKeyRange.upperBound(Number(t[0])):void 0;if(/^\s*[\[\(]\s*(-?\d+(\.\d+)?)\s*\,\s*(-?\d+(\.\d+)?)\s*[\]\)]\s*$/i.test(e)){var t;if(t=e.match(/(-?\d+(\.\d+)?)/g)){var n=t[0],o=t[1],r=[!1,!1],s=r[0],i=r[1];return/^.*\(.*$/.test(e)&&(s=!0),/^.*\).*$/.test(e)&&(i=!0),IDBKeyRange.bound(Number(n),Number(o),s,i)}return}return e}}(arguments[1]):void 0,r=this.store.index(e);return(o?r.openCursor(o):r.openCursor()).addEventListener("success",function(e){n&&n.call(t,e)},!1),this},t}(),n=function(){function n(e,t,n,o){this.indexeddb=e,this.name=t,this.version=n,this.callbackObject=o,this.db=void 0,this.request=this.indexeddb.open(t,n),this.request.addEventListener("success",this.handleOpenDBSuccess.bind(this),!1),this.request.addEventListener("error",this.handleOpenDBError.bind(this),!1),this.request.addEventListener("upgradeneeded",this.handleOpenUpgradeneeded.bind(this),!1)}return n.prototype.handleOpenDBSuccess=function(t){this.callbackObject.success&&(this.db=t.target.result,this.callbackObject.success.call(this,t)),"development"===e&&console.log("打开数据库成功！\nname:    "+this.name+"\nversion: "+this.version)},n.prototype.handleOpenDBError=function(t){this.callbackObject.error&&(console.error(t.target.error.message),this.callbackObject.error.call(this,t)),"development"===e&&console.log("打开数据库失败！\nname:    "+this.name+"\nversion: "+this.version)},n.prototype.handleOpenUpgradeneeded=function(t){this.callbackObject.upgradeneeded&&(this.db=t.target.result,this.callbackObject.upgradeneeded.call(this,t)),"development"===e&&console.log("数据库版本更新！\nname:    "+this.name+"\nversion: "+this.version)},n.prototype.close=function(){this.db&&(this.db.close(),this.db=void 0,"development"===e&&console.log("数据库关闭。\nname:    "+this.name+"\nversion: "+this.version))},n.prototype.hasObjectStore=function(e){return!!this.db&&this.db.objectStoreNames.contains(e)},n.prototype.createObjectStore=function(t,n,o){if(this.db)if(this.hasObjectStore(t))console.warn("ObjectStore："+t+"已存在。");else{var r=this.db.createObjectStore(t,{keyPath:n});if(o)for(var s=0,i=o;s<i.length;s++){var d=i[s];r.createIndex(d.name,d.index)}"development"===e&&console.log("创建了新的ObjectStore："+t+"。")}return this},n.prototype.deleteObjectStore=function(t){return this.db&&(this.hasObjectStore(t)?(this.db.deleteObjectStore(t),"development"===e&&console.log("删除了新的ObjectStore："+t+"。")):console.warn("ObjectStore："+t+"不存在。")),this},n.prototype.getObjectStore=function(e,n){if(void 0===n&&(n=!1),this.db)return new t(this.db,e,n)},n}();function o(){return indexedDB||webkitIndexedDB||mozIndexedDB||msIndexedDB}function r(e,t,s){var i=o();return r.prototype.indexeddb=i,new n(i,e,t,s)}return r.deleteDatabase=function(t){var n=o().deleteDatabase(t);return"development"===e&&console.log("删除数据库："+t+"。"),n},r});
